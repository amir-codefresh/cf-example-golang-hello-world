version: '1.0'
steps:

  perform_tests:
    image: golang:latest
    working_directory: ${{main_clone}}
    description: Performing unit tests...
    commands:
      # Need to have the source in the correct GOPATH folder - let's do that
      - mkdir -p /go/src/github.com/codefreshdemo
      - ln -s /codefresh/volume/cf-example-golang-hello-world /go/src/github.com/codefreshdemo/cf-example-golang-hello-world
      - cd /go/src/github.com/codefreshdemo/cf-example-golang-hello-world && go get
      - cd /go/src/github.com/codefreshdemo/cf-example-golang-hello-world && go test

  build_image:
    type: build
    description: Building the image...
    image_name: codefreshdemo/cf-example-golang-hello-world
    tag: '${{CF_BRANCH}}'
    
  launch_composition:
    type: launch-composition
    composition: docker-compose.yml
